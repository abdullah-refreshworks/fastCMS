{% extends "base.html" %}

{% block title %}{{ collection.name }} Records - FastCMS Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ collection.name }} Records</h1>
    <div>
        <a href="/admin/collections/{{ collection.name }}/records/new" class="btn btn-primary">Create Record</a>
        <a href="/admin/collections/{{ collection.id }}" class="btn">Back to Collection</a>
    </div>
</div>

<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                {% for field in collection.schema[:5] %}
                <th>{{ field.name }}</th>
                {% endfor %}
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for record in records %}
            <tr>
                <td><code>{{ record.id[:8] }}...</code></td>
                {% for field in collection.schema[:5] %}
                <td>
                    {% if record.data.get(field.name) is none %}
                    <span class="text-muted">—</span>
                    {% elif field.type == 'bool' %}
                    {{ '✓' if record.data.get(field.name) else '✗' }}
                    {% elif field.type in ['text', 'email', 'url'] %}
                    {{ record.data.get(field.name)[:50] }}
                    {% elif field.type == 'json' %}
                    <code>{{ record.data.get(field.name) | tojson | truncate(30) }}</code>
                    {% else %}
                    {{ record.data.get(field.name) }}
                    {% endif %}
                </td>
                {% endfor %}
                <td>{{ record.created.strftime('%Y-%m-%d %H:%M') }}</td>
                <td class="actions">
                    <a href="/admin/collections/{{ collection.name }}/records/{{ record.id }}">View</a>
                    <a href="/admin/collections/{{ collection.name }}/records/{{ record.id }}/edit">Edit</a>
                    <a href="/admin/collections/{{ collection.name }}/records/{{ record.id }}/delete" class="text-danger" onclick="return confirm('Are you sure you want to delete this record?')">Delete</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="{{ collection.schema | length + 3 }}" class="text-center">
                    No records yet. <a href="/admin/collections/{{ collection.name }}/records/new">Create your first record</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if total_pages > 1 %}
    <div class="pagination">
        {% if page > 1 %}
        <a href="/admin/collections/{{ collection.name }}/records?page={{ page - 1 }}" class="btn btn-sm">Previous</a>
        {% endif %}
        <span>Page {{ page }} of {{ total_pages }}</span>
        {% if page < total_pages %}
        <a href="/admin/collections/{{ collection.name }}/records?page={{ page + 1 }}" class="btn btn-sm">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
