<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Admin Dashboard{% endblock %} - FastCMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      [x-cloak] {
        display: none !important;
      }

      /* Custom scrollbar for sidebar */
      .sidebar-scroll::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar-scroll::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
      }

      .sidebar-scroll::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
      }

      .sidebar-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Smooth transitions */
      .nav-link {
        transition: all 0.2s ease-in-out;
      }

      .nav-link:hover {
        transform: translateX(4px);
      }

      /* Logo animation */
      @keyframes pulse-glow {
        0%, 100% {
          box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
        }
        50% {
          box-shadow: 0 0 20px 4px rgba(99, 102, 241, 0.2);
        }
      }

      .logo-pulse {
        animation: pulse-glow 3s infinite;
      }
    </style>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>
  <body class="h-full" x-data="{ sidebarOpen: false }">
    <div class="flex h-full">
      <!-- Mobile sidebar backdrop -->
      <div
        x-show="sidebarOpen"
        @click="sidebarOpen = false"
        x-transition:enter="transition-opacity ease-linear duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition-opacity ease-linear duration-300"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-gray-900 bg-opacity-75 z-40 lg:hidden"
        x-cloak
      ></div>

      <!-- Sidebar -->
      <aside
        :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'"
        class="fixed inset-y-0 left-0 z-50 w-72 bg-gradient-to-b from-gray-900 via-gray-900 to-gray-800 transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0"
      >
        <div class="flex flex-col h-full">
          <!-- Logo Header -->
          <div class="flex items-center justify-between h-16 px-6 border-b border-gray-700">
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center logo-pulse">
                <i class="fas fa-bolt text-white text-xl"></i>
              </div>
              <div>
                <h1 class="text-white text-lg font-bold">FastCMS</h1>
                <p class="text-gray-400 text-xs">Admin Panel</p>
              </div>
            </div>
            <button
              @click="sidebarOpen = false"
              class="lg:hidden text-gray-400 hover:text-white transition-colors"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>

          <!-- Navigation -->
          <nav class="flex-1 px-4 py-6 overflow-y-auto sidebar-scroll">
            <div class="space-y-1">
              <!-- Main Section -->
              <div class="mb-6">
                <p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">
                  Main
                </p>
                <a
                  href="/admin/"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg {% if active == 'dashboard' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-chart-line w-5 text-center"></i>
                  <span class="ml-3 font-medium">Dashboard</span>
                  {% if active == 'dashboard' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
              </div>

              <!-- Content Section -->
              <div class="mb-6">
                <p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">
                  Content
                </p>
                <a
                  href="/admin/collections"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg {% if active == 'collections' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-database w-5 text-center"></i>
                  <span class="ml-3 font-medium">Collections</span>
                  {% if active == 'collections' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
                <a
                  href="/admin/files"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg mt-1 {% if active == 'files' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-file w-5 text-center"></i>
                  <span class="ml-3 font-medium">Files</span>
                  {% if active == 'files' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
              </div>

              <!-- Users & Access Section -->
              <div class="mb-6">
                <p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">
                  Users & Access
                </p>
                <a
                  href="/admin/users"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg {% if active == 'users' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-users w-5 text-center"></i>
                  <span class="ml-3 font-medium">Users</span>
                  {% if active == 'users' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
              </div>

              <!-- System Section -->
              <div class="mb-6">
                <p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">
                  System
                </p>
                <a
                  href="/admin/webhooks"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg {% if active == 'webhooks' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-link w-5 text-center"></i>
                  <span class="ml-3 font-medium">Webhooks</span>
                  {% if active == 'webhooks' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
                <a
                  href="/admin/realtime"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg mt-1 {% if active == 'realtime' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-bolt w-5 text-center"></i>
                  <span class="ml-3 font-medium">Real-time</span>
                  {% if active == 'realtime' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
                <a
                  href="/admin/backups"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg mt-1 {% if active == 'backups' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-hdd w-5 text-center"></i>
                  <span class="ml-3 font-medium">Backups</span>
                  {% if active == 'backups' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
                <a
                  href="/admin/settings"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg mt-1 {% if active == 'settings' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-cog w-5 text-center"></i>
                  <span class="ml-3 font-medium">Settings</span>
                  {% if active == 'settings' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
              </div>

              <!-- Developer Section -->
              <div class="mb-6">
                <p class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">
                  Developer
                </p>
                <a
                  href="/admin/api"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg {% if active == 'api' %}bg-indigo-600 text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-800 hover:text-white{% endif %}"
                >
                  <i class="fas fa-code w-5 text-center"></i>
                  <span class="ml-3 font-medium">API Reference</span>
                  {% if active == 'api' %}
                  <div class="ml-auto w-2 h-2 bg-white rounded-full"></div>
                  {% endif %}
                </a>
                <a
                  href="/docs"
                  target="_blank"
                  class="nav-link flex items-center px-3 py-2.5 rounded-lg mt-1 text-gray-300 hover:bg-gray-800 hover:text-white"
                >
                  <i class="fas fa-book w-5 text-center"></i>
                  <span class="ml-3 font-medium">API Docs</span>
                  <i class="fas fa-external-link-alt ml-auto text-xs"></i>
                </a>
              </div>
            </div>
          </nav>

          <!-- User Profile Footer -->
          <div class="border-t border-gray-700 p-4">
            <a
              href="/admin/profile"
              class="flex items-center px-3 py-3 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition-colors"
            >
              <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-white"></i>
              </div>
              <div class="ml-3 flex-1 min-w-0">
                <p class="text-sm font-medium truncate">
                  {% if user %}{{ user.email if user.email else user.user_id }}{% else %}Guest{% endif %}
                </p>
                <p class="text-xs text-gray-500">View Profile</p>
              </div>
              <i class="fas fa-chevron-right text-gray-500 text-xs"></i>
            </a>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="flex-1 flex flex-col min-w-0">
        <!-- Top Bar -->
        <header class="bg-white shadow-sm z-10">
          <div class="flex items-center justify-between px-4 sm:px-6 lg:px-8 h-16">
            <div class="flex items-center">
              <!-- Mobile menu button -->
              <button
                @click="sidebarOpen = true"
                class="lg:hidden text-gray-600 hover:text-gray-900 focus:outline-none mr-4"
              >
                <i class="fas fa-bars text-xl"></i>
              </button>

              <!-- Page Title -->
              <div>
                <h1 class="text-xl font-semibold text-gray-900">
                  {% block page_title %}
                    {% if active == 'dashboard' %}Dashboard
                    {% elif active == 'users' %}Users
                    {% elif active == 'collections' %}Collections
                    {% elif active == 'files' %}Files
                    {% elif active == 'webhooks' %}Webhooks
                    {% elif active == 'backups' %}Backups
                    {% elif active == 'realtime' %}Real-time
                    {% elif active == 'settings' %}Settings
                    {% elif active == 'api' %}API Reference
                    {% elif active == 'profile' %}Profile
                    {% else %}Admin{% endif %}
                  {% endblock %}
                </h1>
              </div>
            </div>

            <!-- Right side actions -->
            <div class="flex items-center space-x-3">
              <button class="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors" title="Notifications">
                <i class="fas fa-bell text-lg"></i>
              </button>
              <a href="/docs" target="_blank" class="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors" title="Documentation">
                <i class="fas fa-question-circle text-lg"></i>
              </a>
            </div>
          </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-gray-100">
          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            {% block content %}{% endblock %}
          </div>
        </main>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
      // Utility functions
      const API_BASE = "/api/v1";

      function showToast(message, type = "info") {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");
        const colors = {
          success: "bg-green-500",
          error: "bg-red-500",
          info: "bg-blue-500",
          warning: "bg-yellow-500",
        };

        const icons = {
          success: "fa-check-circle",
          error: "fa-exclamation-circle",
          info: "fa-info-circle",
          warning: "fa-exclamation-triangle",
        };

        toast.className = `${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 flex items-center space-x-3`;
        toast.innerHTML = `
          <i class="fas ${icons[type]} text-xl"></i>
          <span>${message}</span>
        `;

        container.appendChild(toast);

        setTimeout(() => {
          toast.style.opacity = "0";
          toast.style.transform = "translateX(100%)";
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      async function apiRequest(endpoint, options = {}) {
        const token = localStorage.getItem("access_token");
        const headers = {
          "Content-Type": "application/json",
          ...(token && { Authorization: `Bearer ${token}` }),
          ...options.headers,
        };

        try {
          const response = await fetch(API_BASE + endpoint, {
            ...options,
            headers,
          });

          if (response.status === 401) {
            localStorage.removeItem("access_token");
            window.location.href = "/admin/login";
            return null;
          }

          // Handle 204 No Content responses (e.g., DELETE)
          if (response.status === 204) {
            return null;
          }

          // Parse JSON response
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || data.detail || "Request failed");
          }

          return data;
        } catch (error) {
          // Don't show toast for JSON parse errors on 204
          if (error.message !== "Unexpected end of JSON input") {
            showToast(error.message, "error");
          }
          throw error;
        }
      }
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
