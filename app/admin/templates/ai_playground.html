{% extends "base.html" %}

{% block title %}AI Playground{% endblock %}

{% block content %}
<div class="bg-white shadow sm:rounded-lg">
    <div class="px-4 py-5 sm:p-6">
        <h3 class="text-base font-semibold leading-6 text-gray-900">AI Playground</h3>
        <div class="mt-2 max-w-xl text-sm text-gray-500">
            <p>Test the AI capabilities of FastCMS. You can generate content or query your data using natural language.
            </p>
        </div>

        <div class="mt-5" x-data="{ tab: 'copilot', loading: false, result: null, error: null }">
            <!-- Tabs -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button @click="tab = 'copilot'; result = null; error = null"
                        :class="tab === 'copilot' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700'"
                        class="whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                        Content Copilot
                    </button>
                    <button @click="tab = 'agent'; result = null; error = null"
                        :class="tab === 'agent' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700'"
                        class="whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">
                        Data Analysis Agent
                    </button>
                </nav>
            </div>

            <!-- Content Copilot Form -->
            <div x-show="tab === 'copilot'" class="mt-6 space-y-6">
                <div class="grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                    <div class="sm:col-span-3">
                        <label for="task" class="block text-sm font-medium leading-6 text-gray-900">Task</label>
                        <div class="mt-2">
                            <select id="task" x-ref="task"
                                class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                                <option value="summarize">Summarize</option>
                                <option value="seo">Generate SEO Tags</option>
                                <option value="expand">Expand Content</option>
                                <option value="tone">Adjust Tone</option>
                            </select>
                        </div>
                    </div>

                    <div class="sm:col-span-3">
                        <label for="tone" class="block text-sm font-medium leading-6 text-gray-900">Tone
                            (Optional)</label>
                        <div class="mt-2">
                            <input type="text" x-ref="tone" id="tone"
                                class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                                placeholder="e.g. Professional, Friendly">
                        </div>
                    </div>

                    <div class="col-span-full">
                        <label for="context" class="block text-sm font-medium leading-6 text-gray-900">Context
                            (Optional)</label>
                        <div class="mt-2">
                            <input type="text" x-ref="context" id="context"
                                class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                                placeholder="e.g. Blog post about technology">
                        </div>
                    </div>

                    <div class="col-span-full">
                        <label for="prompt" class="block text-sm font-medium leading-6 text-gray-900">Content /
                            Prompt</label>
                        <div class="mt-2">
                            <textarea id="prompt" x-ref="prompt" rows="5"
                                class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"></textarea>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-end gap-x-6">
                    <button
                        @click="generateContent($refs.task.value, $refs.prompt.value, $refs.context.value, $refs.tone.value)"
                        type="button"
                        class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
                        :disabled="loading">
                        <span x-show="!loading">Generate</span>
                        <span x-show="loading">Generating...</span>
                    </button>
                </div>

                <!-- API Snippet -->
                <div class="mt-4 bg-gray-50 p-4 rounded-md">
                    <h4 class="text-sm font-medium text-gray-900">API Usage</h4>
                    <pre class="mt-2 text-xs text-gray-600 overflow-x-auto">curl -X POST "/api/v1/ai/generate" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "task": "<span x-text="$refs.task.value"></span>",
    "prompt": "...",
    "context": "...",
    "tone": "..."
  }'</pre>
                </div>
            </div>

            <!-- Data Agent Form -->
            <div x-show="tab === 'agent'" class="mt-6 space-y-6">
                <div class="col-span-full">
                    <label for="query" class="block text-sm font-medium leading-6 text-gray-900">Natural Language
                        Query</label>
                    <div class="mt-2">
                        <input type="text" x-ref="query" id="query"
                            class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                            placeholder="e.g. How many users signed up last week?">
                    </div>
                </div>

                <div class="flex items-center justify-end gap-x-6">
                    <button @click="runQuery($refs.query.value)" type="button"
                        class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
                        :disabled="loading">
                        <span x-show="!loading">Ask Agent</span>
                        <span x-show="loading">Thinking...</span>
                    </button>
                </div>

                <!-- API Snippet -->
                <div class="mt-4 bg-gray-50 p-4 rounded-md">
                    <h4 class="text-sm font-medium text-gray-900">API Usage</h4>
                    <pre class="mt-2 text-xs text-gray-600 overflow-x-auto">curl -X POST "/api/v1/ai/agent/query" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "<span x-text="$refs.query.value"></span>"
  }'</pre>
                </div>
            </div>

            <!-- Results -->
            <div x-show="result" class="mt-6">
                <h4 class="text-sm font-medium text-gray-900">Result</h4>
                <div class="mt-2 rounded-md bg-gray-50 p-4">
                    <pre class="whitespace-pre-wrap text-sm text-gray-700" x-text="result"></pre>
                </div>
            </div>

            <div x-show="error" class="mt-6">
                <div class="rounded-md bg-red-50 p-4">
                    <div class="flex">
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Error</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <p x-text="error"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function generateContent(task, prompt, context, tone) {
        this.loading = true;
        this.error = null;
        this.result = null;

        apiRequest('/ai/generate', {
            method: 'POST',
            body: JSON.stringify({
                task,
                prompt,
                context: context || undefined,
                tone: tone || undefined
            })
        })
            .then(data => {
                this.result = data.content;
            })
            .catch(err => {
                this.error = err.message;
            })
            .finally(() => {
                this.loading = false;
            });
    }

    function runQuery(query) {
        this.loading = true;
        this.error = null;
        this.result = null;

        apiRequest('/ai/agent/query', {
            method: 'POST',
            body: JSON.stringify({ query })
        })
            .then(data => {
                this.result = `Answer: ${data.answer}\n\nSQL: ${data.sql_query}`;
            })
            .catch(err => {
                this.error = err.message;
            })
            .finally(() => {
                this.loading = false;
            });
    }
</script>
{% endblock %}